<htmlform formUuid="faeb334f-aec1-41d7-ae1e-393a1c3875b6" formName="Medication Order" formEncounterType="f549375c-e5a0-4fac-bffd-42c5f7c325fc" formVersion="2.0">

    <style type="text/css">
        #who-when-where {
            margin-bottom: 6px;
            border-bottom: 1px solid #ccc;
        }

        #who-when-where p {
            display: inline-block;
            padding-right: 20px;
        }

        #where > input[type=text] {
            display: inline-block;
        }

        .field-error {
            color: #ff6666;
            font-size: 1.1em;
            display: block;
        }

        <ifMode mode="VIEW" include="false">
            #data-collection {
                display: inline-block;
                width: 58%;
                vertical-align: top;
            }

            #encounter-diagnoses-target {
                display: inline-block;
                width: 40%;
                vertical-align: top;
            }

            #encounter-diagnoses-app {
                margin-bottom: 20px;
            }
        </ifMode>
    </style>

    <ifMode mode="VIEW" include="false">
		<script type="text/javascript">
			<!-- 07/08/2015 Romain: Dose Calculation Helper is set aside for now to simplify the UI
			function calculateDose (weight, doseCalculation){
				var dose = (weight * doseCalculation);
				return dose;
			}
			function updateDose (weight, doseCalculation, sectionNo) {
				if (!(weight == null) ) {
					jQuery("#weight-value").show();
					jQuery("#weight-null").hide();
					var dose = calculateDose(weight, doseCalculation);
					setValue("dose.value", dose);
					setValue("dose-unit.value", 161553)
				}
				else {
					jQuery("#weight-value").hide();
					jQuery("#weigh-null").show();
				}
			}
			-->
			jQuery(function () {
				jQuery("#weight-value").hide();
				jQuery("#weight-null").hide();
				var weight = jQuery(htmlform).find("#weight").text();
				if (!(weight === "")) {
					jQuery("#weight-value").show();
					jQuery("#weight-null").hide();
				}else {
					jQuery("#weight-value").hide();
					jQuery("#weight-null").show();
				}
				jQuery( ".dose-calculation" ).change(function() {
					var doseCalculation = document.getElementById("dose-calculation").value;
					var weight = jQuery(htmlform).find("#weight").text();
					updateDose(weight, doseCalculation);
				});
			});
		</script>
	</ifMode>

    <ifMode mode="VIEW" include="false">
        <h2><uimessage code="referenceapplication.visitNote.title"/></h2>

        <div id="who-when-where">
            <p id="who">
                <label><uimessage code="coreapps.patientDashBoard.provider"/></label>
                <span><encounterProvider default="currentUser" required="true"  /></span>
            </p>
            <p id="when">
                <label><uimessage code="coreapps.patientDashBoard.location"/></label>
                <span><encounterLocation default="SessionAttribute:emrContext.sessionLocationId"/></span>
            </p>
            <p id="where">
                <label><uimessage code="coreapps.patientDashBoard.date"/></label>
                <span><encounterDate id="encounterDate" default="now" /></span>
            </p>
        </div>
    </ifMode>

    <div id="data-collection">

        <obsgroup groupingConceptId="160741">
        	<p>
				<obs id="drug-ordered" conceptId="CIEL:1282" answerClasses="Drug" style="autocomplete" size="10" labelText="Drug to order"/>
			</p>

			<ifMode mode="VIEW" include="false">
				<p>
					<span id="weight-value">
						<p><strong>Patient weight is <span id="weight"><lookup expression="fn.latestObs('CIEL:5089').valueNumeric" /></span>kg</strong>
						</p>
					</span>
					<span id="weight-null">
						<font color="red"><i class="icon-">&#xf071;</i>Weight has not been recorded yet</font>
					</span>
				</p>
			</ifMode>

			<p>
				<obs id="dose" conceptId="CIEL:160856" labelText="Dose" />
			</p>

			<p>
				<obs id="dose-unit" conceptId="CIEL:161563" labelText="Unit" answerConceptIds="CIEL:161553, CIEL:161554, CIEL:162263, CIEL:162366" answerLabels="mg, g, ml, mcg" />
			</p>

			<p>
				<obs id="frequency"	conceptId="CIEL:160855" labelText="Frequency" />
			</p>
			<p>
				<obs id="prn" conceptId="CIEL:160855" answerConceptId="CIEL:160857"/> 
			</p>

			<p>
				<obs id="duration" conceptId="CIEL:159368" showUnits="days" labelText="Duration" />
			</p>

			<p>
				<obs id="indication" conceptId="CIEL:160742" answerClasses="Diagnosis" style="autocomplete" labelText="Indication" />
			</p>
		</obsgroup>

    </div>

    <ifMode mode="VIEW" include="false">
        <div id="buttons">
            <submit submitClass="confirm right" submitCode="general.save"/>
            <button type="button" class="cancel"><uimessage code="general.cancel"/></button>
        </div>
    </ifMode>

</htmlform>